String.prototype.replaceAll=function(a,b){var c=this;return c.split(a).join(b)};var app=angular.module("app",["ui.bootstrap","ngCookies"]);app.filter("transform",[function(){return function(b){return(Math.round(b*10000)/100)+"%"}}]);app.controller("controller",["$scope","$cookies","fileReader",function(b,c,a){b.showMoreResults=function(){b.showMax+=100;if(b.showMax>b.bodyDataFiltered.length){b.showMax=b.bodyDataFiltered.length}};b.getClass=function(e,d){if(b.getCellType(d)=="p"||b.getCellType(d)=="f"){if(parseFloat(e)<0){return"table-danger"}else{if(parseFloat(e)>=0){return"table-success"}}}};b.addAlert=function(e,d){b.alerts.push({msg:e,type:d});setTimeout(function(){b.$apply(function(){b.closeAlert(b.alerts.length-1)})},2000)};b.closeAlert=function(d){b.alerts.splice(d,1)};b.saveFilter=function(){b.savedFilters.push(b.currFilter);c.putObject("savedFilters",b.savedFilters);b.addAlert("Filter sparat.","primary");b.loadSavedFilters()};b.removeFilterSaved=function(e){var d=-1;for(i=0;i<b.savedFilters.length;i++){if(b.savedFilters[i].id==e.id){d=i;break}}if(d!=-1){b.savedFilters.splice(d,1);b.addAlert("Filter borttaget.","primary");c.putObject("savedFilters",b.savedFilters);b.loadSavedFilters()}else{b.addAlert("Kunde ej ta bort filter.","danger")}};b.addFilter=function(){var d=false;for(i=0;i<b.currFilter.data.length;i++){if(b.selectedFilter&&b.currFilter.data[i].index==b.selectedFilter.index){d=true;break}}if(!d){if(b.selectedFilter){b.currFilter.data.push(b.selectedFilter)}else{}b.filter()}else{b.addAlert("Valda filtret finns redan.","danger")}};b.removeFilter=function(d){var e=-1;for(i=0;i<b.currFilter.data.length;i++){if(b.currFilter.data[i].index==d){e=i;break}}if(e!=-1){b.currFilter.data.splice(e,1)}b.filter()};b.filter=function(){b.bodyDataFiltered=new Array();var e=new Array();for(i=0;i<b.currFilter.data.length;i++){if(b.currFilter.data[i]&&(b.currFilter.data[i].min||b.currFilter.data[i].max||b.currFilter.data[i].equal)){e.push(b.currFilter.data[i])}}var d;var h;if(b.bodyData){for(i=0;i<b.bodyData.length;i++){d=true;for(j=0;j<e.length;j++){h=b.bodyData[i][e[j].index];if(e[j].min){if(isNaN(h)||!(parseFloat(h)>parseFloat(e[j].min))){d=false}}if(e[j].max){if(isNaN(h)||!(parseFloat(h)<parseFloat(e[j].max))){d=false}}if(e[j].equal&&e[j].equal.length>0){var g=e[j].equal;g=g.trim();g=g.toLowerCase();if(h&&h.toLowerCase().indexOf(g)==-1){d=false}}}if(d){b.bodyDataFiltered.push(b.bodyData[i])}}}b.showMax=100};b.buildFilter=function(){var d=[];b.filterData=new Array();for(i=0;i<b.headerData.length;i++){b.filterData.push({name:b.headerData[i]["name"],index:i,type:b.headerData[i]["type"]})}if(b.currFilter.data.length>0){for(i=0;i<b.currFilter.data.length;i++){for(j=0;j<b.filterData.length;j++){if(b.currFilter.data[i]["name"]==b.filterData[j]["name"]&&b.currFilter.data[i]["index"]==b.filterData[j]["index"]){d.push(true);break}}}}if(!b.currFilter.data||d.length!=b.currFilter.data.length){b.currFilter={name:"Filter-"+Date.now(),id:Date.now(),data:new Array()};b.addAlert("Inte godkÃ¤nt filter. Skapar ett nytt","danger")}b.bodyDataFiltered=b.bodyData;b.filter()};b.getCellType=function(d){return b.headerData[d]["type"]};b.determineCellType=function(d,e){if(d){if((d.match(/[a-z]/i))||isNaN(parseFloat(d))){b.headerData[e]["type"]="s"}else{var f=String(d).split(".");if(f[1]&&String(f[1]).trim().length>3){b.headerData[e]["type"]="p"}if(b.headerData[e]["type"]!="p"){b.headerData[e]["type"]="f"}}}};b.getFile=function(){var d=document.getElementById("file");a.readAsText(d.files[0],b).then(function(t){b.showResult=true;b.filterData=new Array();b.headerData=new Array();b.bodyData=new Array();b.bodyDataFiltered=new Array();var s=t.split(String.fromCharCode(13));var h=s[0].split(";");var k=s[1].split(";");var n=t.split(";");var f=h.length*2;var g=h.length*3;var l=0;var m;var q=[];q[0]=[];var e=0;var o=null;for(i=f-2;i<n.length;i++){m=n[i];if(l==0){var p=n[i].split(String.fromCharCode(10));m=p[1];o=p[0];if(o){q[e].push(o.replaceAll('"',""))}l=h.length-1;e++;q[e]=[]}if(m){q[e].push(m.replaceAll('"',""))}l--}q.shift();q.pop();for(i=0;i<h.length;i++){h[i]=h[i].replaceAll('"',"")}for(i=0;i<k.length;i++){k[i]=k[i].replaceAll('"',"")}for(i=0;i<h.length;i++){tmp=h[i]+" "+k[i];b.headerData.push({name:tmp,type:null})}for(i=0;i<q.length;i++){for(l=0;l<q[i].length;l++){b.determineCellType(q[i][l],l)}b.bodyData.push(q[i])}b.buildFilter()})};b.loadFilter=function(d){b.currFilter=d;b.addAlert("Filter laddat.","primary");b.buildFilter()};b.loadSavedFilters=function(){var d=c.getObject("savedFilters");if(d){b.savedFilters=d}else{b.savedFilters=new Array()}};b.showResult=false;b.showMax=100;b.message=null;b.alerts=[];b.currFilter={name:"Filter-"+Date.now(),id:Date.now(),data:new Array()};b.loadSavedFilters()}]);