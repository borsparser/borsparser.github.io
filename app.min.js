String.prototype.replaceAll=function(a,b){var c=this;return c.split(a).join(b)};var app=angular.module("app",["ui.bootstrap","ngCookies"]);app.filter("transform",[function(){return function(b){return(Math.round(b*10000)/100)+"%"}}]);app.controller("controller",["$scope","$cookies","fileReader",function(b,c,a){b.showMoreResults=function(){b.showMax+=100;if(b.showMax>b.bodyDataFiltered.length){b.showMax=b.bodyDataFiltered.length}};b.getClass=function(e,d){if(b.getCellType(d)=="p"||b.getCellType(d)=="f"){if(parseFloat(e)<0){return"table-danger"}else{if(parseFloat(e)>=0){return"table-success"}}}};b.addAlert=function(e,d){b.alerts.push({msg:e,type:d});setTimeout(function(){b.$apply(function(){b.closeAlert(b.alerts.length-1)})},2000)};b.closeAlert=function(d){b.alerts.splice(d,1)};b.loadFilter=function(d){b.currFilter=d;b.addAlert("Filter laddat.","primary");b.buildFilter()};b.loadSavedFilters=function(){var d=c.getObject("savedFilters");if(d){b.savedFilters=d}else{b.savedFilters=new Array()}};b.saveFilter=function(){if(b.currFilter.data.length>0){var d=false;for(i=0;i<b.savedFilters.length;i++){if(b.savedFilters[i].name==b.currFilter.name){b.savedFilters[i].data=b.currFilter.data;d=true;break}}if(!d){b.savedFilters.push(b.currFilter)}c.putObject("savedFilters",b.savedFilters)}b.loadSavedFilters()};b.createEmptyFilter=function(){b.currFilter={name:"Filter-"+Date.now(),id:Date.now(),data:new Array()}};b.removeFilterSaved=function(e){var d=-1;for(i=0;i<b.savedFilters.length;i++){if(b.savedFilters[i].id==e.id){d=i;break}}if(d!=-1){b.savedFilters.splice(d,1);b.addAlert("Filter borttaget.","primary");c.putObject("savedFilters",b.savedFilters);b.loadSavedFilters()}else{b.addAlert("Kunde ej ta bort filter.","danger")}};b.addFilter=function(){var d=false;for(i=0;i<b.currFilter.data.length;i++){if(b.selectedFilter&&b.currFilter.data[i].index==b.selectedFilter.index){d=true;break}}if(!d){if(b.selectedFilter){b.currFilter.data.push(b.selectedFilter)}else{}b.filter()}else{b.addAlert("Valda filtret finns redan.","danger")}};b.removeFilter=function(d){var e=-1;for(i=0;i<b.currFilter.data.length;i++){if(b.currFilter.data[i].index==d){e=i;break}}if(e!=-1){b.currFilter.data.splice(e,1)}b.filter()};b.filter=function(){b.bodyDataFiltered=new Array();var e=new Array();for(i=0;i<b.currFilter.data.length;i++){if(b.currFilter.data[i]&&(b.currFilter.data[i].min||b.currFilter.data[i].max||b.currFilter.data[i].equal)){e.push(b.currFilter.data[i])}}var d;var h;if(b.bodyData){for(i=0;i<b.bodyData.length;i++){d=true;for(j=0;j<e.length;j++){h=b.bodyData[i][e[j].index];if(e[j].min){if(isNaN(h)||!(parseFloat(h)>parseFloat(e[j].min))){d=false}}if(e[j].max){if(isNaN(h)||!(parseFloat(h)<parseFloat(e[j].max))){d=false}}if(e[j].equal&&e[j].equal.length>0){var g=e[j].equal;g=g.trim();g=g.toLowerCase();if(h&&h.toLowerCase().indexOf(g)==-1){d=false}}}if(d){b.bodyDataFiltered.push(b.bodyData[i])}}}b.saveFilter();b.showMax=100};b.buildFilter=function(){var d=[];b.filterData=new Array();for(i=0;i<b.headerData.length;i++){b.filterData.push({name:b.headerData[i]["name"],index:i,type:b.headerData[i]["type"]})}if(b.currFilter.data.length>0){for(i=0;i<b.currFilter.data.length;i++){for(j=0;j<b.filterData.length;j++){if(b.currFilter.data[i]["name"]==b.filterData[j]["name"]&&b.currFilter.data[i]["index"]==b.filterData[j]["index"]){d.push(true);break}}}}if(!b.currFilter.data||d.length!=b.currFilter.data.length){b.createEmptyFilter();b.addAlert("Inte godkänt filter. Skapar ett nytt","danger")}b.bodyDataFiltered=b.bodyData;b.filter()};b.getCellType=function(d){return b.headerData[d]["type"]};b.determineCellType=function(d,e){if(d){if((d.match(/[a-z]/i))||isNaN(parseFloat(d))){b.headerData[e]["type"]="s"}else{var f=String(d).split(".");if(f[1]&&String(f[1]).trim().length>3){b.headerData[e]["type"]="p"}if(b.headerData[e]["type"]!="p"){b.headerData[e]["type"]="f"}}}};b.getFile=function(){var g=document.getElementById("file");if(g.files.length==1){var d=g.files[0].name;var f=d.substr(d.lastIndexOf("."));if(f==".csv"){a.readAsText(g.files[0],b).then(function(w){b.showResult=true;b.filterData=new Array();b.headerData=new Array();b.bodyData=new Array();b.bodyDataFiltered=new Array();var u=w.split(String.fromCharCode(13));var l=u[0].split(";");var m=u[1].split(";");var p=w.split(";");var h=l.length*2;var k=l.length*3;var n=0;var o;var t=[];t[0]=[];var e=0;var q=null;for(i=h-2;i<p.length;i++){o=p[i];if(n==0){var s=p[i].split(String.fromCharCode(10));o=s[1];q=s[0];if(q){t[e].push(q.replaceAll('"',""))}n=l.length-1;e++;t[e]=[]}if(o){t[e].push(o.replaceAll('"',""))}n--}t.shift();t.pop();for(i=0;i<l.length;i++){l[i]=l[i].replaceAll('"',"")}for(i=0;i<m.length;i++){m[i]=m[i].replaceAll('"',"")}for(i=0;i<l.length;i++){tmp=l[i]+" "+m[i];b.headerData.push({name:tmp,type:null})}for(i=0;i<t.length;i++){for(n=0;n<t[i].length;n++){b.determineCellType(t[i][n],n)}b.bodyData.push(t[i])}b.buildFilter()})}else{b.addAlert("Välj en .csv fil.","danger")}}else{}};b.showResult=false;b.showMax=100;b.message=null;b.alerts=[];b.createEmptyFilter();b.loadSavedFilters()}]);